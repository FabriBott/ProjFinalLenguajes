<%= form_with(model: producto, local: true, class: "needs-validation", novalidate: true) do |form| %>
  <% if producto.errors.any? %>
    <div class="alert alert-danger">
      <h4 class="alert-heading"><%= pluralize(producto.errors.count, "error") %> impidieron guardar el producto:</h4>
      <ul class="mb-0">
        <% producto.errors.full_messages.each do |message| %>
          <li><%= message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>
  
  <div class="mb-3">
    <%= form.label :nombre, "Nombre del Producto", class: "form-label" %>
    <%= form.text_field :nombre, class: "form-control", placeholder: "Ej: Laptop Dell Inspiron", required: true %>
    <div class="invalid-feedback">
      Por favor ingrese un nombre para el producto.
    </div>
  </div>
  
  <div class="mb-3">
    <%= form.label :precio, "Precio (₡)", class: "form-label" %>
    <div class="input-group">
      <span class="input-group-text">₡</span>
      <%= form.number_field :precio, step: 0.01, min: 0, class: "form-control", placeholder: "0.00", required: true %>
    </div>
    <div class="invalid-feedback">
      Por favor ingrese un precio válido.
    </div>
  </div>
  
  <div class="mb-3">
    <%= form.label :stock, "Cantidad en Stock", class: "form-label" %>
    <%= form.number_field :stock, step: 1, min: 0, class: "form-control", placeholder: "0", required: true %>
    <div class="invalid-feedback">
      Por favor ingrese una cantidad válida.
    </div>
  </div>
  
  <!-- Vista previa del producto -->
  <div class="card mb-4" id="product-preview" style="display: none;">
    <div class="card-header">
      <h5 class="mb-0">Vista Previa</h5>
    </div>
    <div class="card-body">
      <h6 id="preview-name">Nombre del Producto</h6>
      <p class="mb-1"><strong>Precio:</strong> <span id="preview-price">₡0.00</span></p>
      <p class="mb-0"><strong>Stock:</strong> <span id="preview-stock">0</span> unidades</p>
    </div>
  </div>
  
  <div class="d-flex gap-3 justify-content-end mt-4">
    <%= link_to productos_path, class: "btn btn-outline-secondary btn-lg" do %>
      <i class="fas fa-times me-2"></i>
      Cancelar
    <% end %>
    <%= form.submit (producto.new_record? ? 'Crear Producto' : 'Actualizar Producto'), class: "btn btn-success btn-lg" %>
  </div>
<% end %>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const form = document.querySelector('.needs-validation');
    const nameInput = document.querySelector('#producto_nombre');
    const priceInput = document.querySelector('#producto_precio');
    const stockInput = document.querySelector('#producto_stock');
    const preview = document.querySelector('#product-preview');
    
    function updatePreview() {
      const name = nameInput.value || 'Nombre del Producto';
      const price = priceInput.value || '0.00';
      const stock = stockInput.value || '0';
      
      document.querySelector('#preview-name').textContent = name;
      document.querySelector('#preview-price').textContent = `₡${parseFloat(price).toLocaleString('es-CR', {minimumFractionDigits: 2})}`;
      document.querySelector('#preview-stock').textContent = stock;
      
      if (name && price && stock) {
        preview.style.display = 'block';
      } else {
        preview.style.display = 'none';
      }
    }
    
    [nameInput, priceInput, stockInput].forEach(input => {
      input.addEventListener('input', updatePreview);
    });
    
    // Validación del formulario
    form.addEventListener('submit', function(event) {
      if (!form.checkValidity()) {
        event.preventDefault();
        event.stopPropagation();
      }
      form.classList.add('was-validated');
    });
    
    // Inicializar preview
    updatePreview();
  });
</script>
  